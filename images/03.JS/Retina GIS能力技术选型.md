## 技术选型

### 什么是GIS？

要了解Retina产品GIS能力中，二维地图选择Leaflet的由来，首先要了解什么是GIS？

> 地理信息系统(Geographic Information System,GIS)是以采集、储存、管理、显示和分析地球表面与空间、地理分布有关的数据的综合计算机信息系统,是一种分析和处理海量空间数据的技术。

### GIS技术发展史

GIS发展紧贴这IT技术的发展，GIS的发展经过从C端到B端的过程。

1、集成GIS

在早期开发GIS的时候，因受到技术因素的制约，GIS技术仅仅可以提供某种功能的模块，且每个模块间缺乏应有的协调性。所以，此时的GIS软件应用尚且不够完善。近年来，随着科学技术的迅速发展，各个GIS模块开始呈现集成化发展趋势，并构成了大容量的GIS软件包，这标志着GIS步入集成GIS（即IntegratedGIS）时期。此时期的GIS主要包括Arc/info，GenaMap等软件。GIS技术已经集各GIS模块的功能，发展成为独立完善的信息系统，具有非常强大的空间分析、数据输入、图形处理等功能。因为单纯对原有较为分散的GIS模块加以初步集成，集成GIS与其他应用技术的集成难以实现，这也是GIS发展中的关键问题。

2、模块GIS

与集成GIS相近，模块GIS也是对GIS依据相关的功能进行模块的划分，且各个模块必须在相同的基础环境状态下有效地运行，然而，模块GIS可以根据实际的工程应用情况，有针对性地细分GIS技术，既缓解了研发工作的难度，又更好地满足客户的具体需求，这也是与前者的显著差异。

可是，无论是集成GIS，还是模块GIS技术二者均**不能和管理信息系统（MIS专业应用模型）进行综合高效地运用**。

3、核心型GIS

核心型GIS提供有效解决与MIS综合高效应用的问题的全新思路，即对于数据库管理标准高的客户，可以通过MIS开发软件实现GIS的应用。在微软公司的操作系统里，可以运用高级编程语言研发GIS应用系统，通过相关的接口（API）对系统提供的GIS各项功能进行访问。例如：核心型GIS某些动态的链接库，不同DLL功能能够重新组合，极大地增强了客户应用的便捷性。

同时，应当注意的是，核心型GIS提供的组件一般在底层，系统研发工作的难度较大。

4、组件型GIS

组件型GIS把GIS系统内部的各项功能进行分解，成为许多不同功能的组件，把可视化界面与接口进行正确组合以后即可进行实际应用。

组件型GIS是新兴的一种GIS软件，相比以往的GIS技术主要具有以下优点：

- 其一，能够无缝集成各类应用分析模型和GIS技术功能；
- 其二，不需要特定的开发语言，仅需系统最基本的功能函数，依据微软公司的ActiveX空间要求对接口进行研发，二次研发十分简单便捷；
- 其三，具有灵活封装与定制功能；
- 其四，方便客户选择，节约研发软件的资本投入；
- 其五，GIS性能更加优越，有利于进一步升级。

同时，组件型GIS技术在设计规划与研发过程中还需要注意以下几个问题：

- （1）功能与接口设计不但要达到GIS软件研发的相关标准，而且还要充分体现该款软件的优点；
- （2）在对组件力度与接口进行设计的时候，需要竭力做到系统功能的发挥、组件灵活性、客户需求之间的平衡。

5、万维网GIS

万维网GIS是GIS技术与WWW（即WorldWideWeb）有机结合的产物，在Internet网络状态下，能够实现信息的采集、储存、分析、处理、显示、应用功能。随着科学技术的迅速发展，万维网GIS技术能够有效地利用互联网技术显示相关的地理信息，客户在浏览器中进行信息的搜索，即可得到GIS的数据与有关服务。这项技术是一种分布式的地理信息模型，通常包括四部分。与以往的GIS技术相比，万维网GIS的桌面系统操作简单，且应用性能较高。

与以往的GIS技术相比，主要具有以下优点：

- 其一，查询范围广泛，客户能够实时地搜索多个处于不同地域服务器的最新信息；
- 其二，平台的独立性较好；
- 其三，系统研发成本偏低，工作效率高；
- 其四，操作简单，易于应用与推广。

同时，WebGIS也具有相应的缺陷：例如：异构空间信息很难进行互操作；跨平台操作受到较多因素的影响；海量信息的传输效率有待提升；对其他资源的利用率不足等。

### WebGIS技术发展史

要了解Retina产品GIS能力中，二维地图选择Leaflet的由来，首先要了解WebGIS发展史。

关于WebGIS的开发，经历了非常多的技术变革了，从最早的ArcIMS Viewer，到后来痛苦的`ArcGIS ADF`，`ArcGIS JavaScript /Flex API` 等，无一不是重量级WebGIS框架或API，其中也有着不短的学习和适应过程。

前几年比较流行的`Flex`和`silverlight`富客户端开发，随着Adobe、微软这些厂家断奶以及各种浏览器不在默认支持，已经逐渐失去了往日的风采，而esri也是跟着潮流，flex、silverlight 开发API已经停止更新，所以，如果想继续从事专业领域上的WebGIS开发，似乎也只剩下JavaScript这一项技术了。
当然，关于Web地图的前端框架，目前也有不少比较优秀的，通用领域上的`Openlayers`，异军突起的`leaflet`，也都是不错的选择。当然，也还有一部分回到服务和前端一体化的`sharpmap`（好多年前的技术了）。不管怎样，条条大路通罗马，达到目的就好。

JavaScript技术下的前端地图框架：

- ArcGIS JavaScript API：在专业领域上，应该更多人使用的是ArcGIS JavaScript API进行开发，毕竟背后有着Esri厂家的支持，熟悉ArcGIS软件体系的开发者在这方面似乎也是得心应手。但是，ArcGIS JavaScript API从第一版到现在，迭代了好几年了，始终都没有摆脱一个庞然大物--dojo！很多js开发人员也是对dojo非常头痛，尽管它也是一个非常优秀的js框架，但在框架方面，毕竟更多人还是比较倾向于jquery吧。

- leaflet：笔者也算是ArcGIS产品的死忠了，毕竟专业GIS领域上，ArcGIS产品还是口碑非常好的，也是产品结构非常清晰，API接口功能也非常齐全。但一旦到了使用JavaScript API进行开发，关于dojo部分还是需要慢慢的切换。也许Esri也意识到这个问题，也正在做一些非常积极的措施，例如，在其GitHub 上 http://esri.github.io/ 可以看到一些与开源JS框架的对接方案，排在第一位的自然就是leaflet了。

   ![esriOpenSource](/Users/liyang/项目/我的笔记本/images/03.JS/imgs/esriOpenSource.png)

### 常见前端地图框架对比

ArcGIS JS API

关于专业GIS，放在整个IT技术来说，关注的人其实并不多，大部分IT从业者一般会跟消费级的地图应用会扯上一些关系，基本上就是调用百度、谷歌、高德等在线地图，并在此之上进行一些应用开发。而专业的WebGIS应用开发人员，一般会跟着如Esri这些巨擘走，进而投身非常专业的ArcGIS JS API 开发中去。是一个**重量级的地图js框架**。

Openlayer/Leaflet

具有丰富的轻量级插件、性能高、稳定性高、扩展性高，以及丰富和完善的社区，相较于openlayers具有更轻量级、更丰富的插件以及对移动端的交互更为友善，相较于arcgis for js具有免费、开源、轻量级、性能高、插件丰富等优势。

关于leaflet，可能很多人比较陌生，稍微百度一下，也就知道，它是一个**轻量级的地图js框架**。leaflet的种种好处，似乎已经有不少人写过相关的文章，这里就不多累赘去说明了。

|  地图基础库  | ArcGIS JS API | for Leaflet | for OpenLayers |
| :----------: | :-----------: | :---------: | :------------: |
| 客户端可视化 |       √       |      √      |       √        |
|   动态标绘   |       √       |      √      |       -        |
|  客户端分析  |       √       |      √      |       √        |
|     控件     |       √       |      √      |       √        |
|     组件     |       √       |      √      |       -        |
|     OGC      |       √       |      √      |       √        |
|  互联网地图  |       √       |      √      |       √        |

### 地图基础库浏览器兼容性



|   地图基础库   | **Desktop** Chrome | **Desktop** Firefox | **Desktop** IE | **Desktop** Opera | **Desktop** Safari | **Mobile** Chrome | **Mobile** Firefox | **Mobile** IE |      **Mobile** Safari       | **Mobile** Android Browser |
| :------------: | :----------------: | :-----------------: | :------------: | :---------------: | :----------------: | :---------------: | :----------------: | :-----------: | :--------------------------: | -------------------------- |
|  for Leaflet   |       26.0+        |        23.0+        |      7-11      |       12.0+       |        5.0+        | Chrome Mobile 47+ |        55+         | 10+ for Win8  |          for iOS 7+          | 2.2+, 3.1+, 4.0+           |
| for OpenLayers |       26.0+        |        23.0+        |     10.0+      |       20.0+       |        5.0+        | Chrome Mobile 47+ |        55+         | 10+ for WP7+  | Mobile Safari 9.0+for iOS 9+ | 4.4+                       |

注： Leaflet 主要功能在IE下的兼容性情况(1.2.0暂时还不支持IE8,请使用1.0.3)

| GIS服务 | GIS服务(data flow) | 可视化 (客户端专题图) | 可视化 (ECharts) | 可视化 (MapV) | 可视化 (D3) | 客户端分析 (Turf) | 三方服务 (Elasticsearch) |
| :-----: | :----------------: | :-------------------: | :--------------: | :-----------: | :---------: | :---------------: | :----------------------: |
|  IE8+   |       IE10+        |         IE9+          |       IE8+       |     IE10+     |    IE9+     |       IE9+        |          IE11+           |

### 地图基础库优劣对比

以下是目前最流行的开源地图js框架能力和活跃性对比，从中可以看出Leaflet有能力强（其中可扩展性最为明显）、活跃度高、轻量级等特点。

|       指标       | for Leaflet  | for OpenLayers |
| :--------------: | :----------: | :------------: |
|   遵守开源协议   | BSD-2-Clause |  BSD-2-Clause  |
| 是否存在闭源风险 |      否      |       否       |
|     优势特性     | 轻量插件丰富 | HTML5OL-Cesium |
|     劣势特性     |  插件稳定性  |  较重插件较少  |
|       性能       |      中      |     **高**     |
|      稳定性      |    **高**    |       中       |
|      扩展性      |   **很好**   |      较好      |
|       文档       | 较好(无中文) |  较好(无中文)  |
|      Stars       |  **26,521**  |     6,134      |
|   Contributors   |   **641**    |      252       |
|     Commits      |    6,807     |   **26,866**   |
|  Pull Requests   |     114      |       12       |
|      Issues      |     393      |    **119**     |
|      Forks       |  **4,400**   |     2,100      |
|    软件成熟度    |    **高**    |      中等      |
|    社区生态链    | **非常完善** |     较完善     |
|     学习成本     |      中      |       高       |

注：社区活跃度统计(Stars、Contributors、Commits、Pull Requests、Issues、Forks)时间为 2019年12月

### 选型确定

Leaflet和Openlayer都是两个主要的开源前端库。开放的程度都很高，但是考虑到移动端和小巧轻便易扩展，我大部分情况还是选择leaflet。

同时公司内部的AiMap也是基于leaflet编写，选型leaflet更方便与过度到将来基于Leaflet开发Team自己的SDK，用所以选择leaflet作为地图框架。

 